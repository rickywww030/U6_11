<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <title>Unity Web Player | RE_Web</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">

  <!-- === Global fullscreen layout === -->
  <style>
    html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#000;}
    #unity-container{position:fixed;top:0;left:0;width:100%;height:100%;}
    #unity-canvas{width:100%;height:100%;background:#231F20;}

    /* Hide all loading-bar elements */
    #unity-loading-bar,
    #unity-logo,
    #unity-progress-bar-empty,
    #unity-progress-bar-full {display:none!important;}

    /* Footer & misc (保留看需要可刪) */
    #unity-footer{position:relative;}
    .unity-mobile #unity-footer{display:none;}
    #unity-logo-title-footer{float:left;width:102px;height:38px;
      background:url('unity-logo-title-footer.png') no-repeat center;}
    #unity-build-title{float:right;margin-right:10px;line-height:38px;
      font-family:arial;font-size:18px;}
    #unity-fullscreen-button{cursor:pointer;float:right;width:38px;height:38px;
      background:url('fullscreen-button.png') no-repeat center;}
    #unity-warning{position:absolute;left:50%;top:5%;transform:translateX(-50%);
      background:#fff;padding:10px;display:none;}
  </style>
</head>

<body>
  <div id="unity-container">
    <canvas id="unity-canvas" tabindex="-1"></canvas>
    <div id="unity-warning"></div>
    <div id="unity-footer">
      <div id="unity-logo-title-footer"></div>
      <div id="unity-fullscreen-button"></div>
      <div id="unity-build-title">RE_Web</div>
    </div>
  </div>

  <script>
    const canvas = document.querySelector('#unity-canvas');
    let unityInstance = null;      // 供全域 resize 使用

    /* --- 可選：錯誤/警告視覺提示 --- */
    function unityShowBanner(msg, type) {
      const warning = document.querySelector('#unity-warning');
      const div = document.createElement('div');
      div.textContent = msg;
      div.style = `background:${type==='error'?'red':'yellow'};padding:10px;`;
      warning.appendChild(div);
      if(type!=='error') setTimeout(()=>warning.removeChild(div), 5000);
    }

    /* --- Unity build 設定 --- */
    const buildUrl = 'Build';
    const config = {
      dataUrl:        buildUrl + '/WebGame.data.unityweb',
      frameworkUrl:   buildUrl + '/WebGame.framework.js.unityweb',
      codeUrl:        buildUrl + '/WebGame.wasm.unityweb',
      streamingAssetsUrl: 'StreamingAssets',
      companyName:    'ArtRice',
      productName:    'RE_Web',
      productVersion: '0.1',
      devicePixelRatio: 1,             // 降低高 DPI 閃黑機率
      matchWebGLToCanvasSize: false,   // 關閉即時同步
      showBanner: unityShowBanner,
    };

    /* --- mobile viewport meta --- */
    if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){
      const meta=document.createElement('meta');
      meta.name='viewport';
      meta.content='width=device-width,height=device-height,initial-scale=1.0,user-scalable=no,shrink-to-fit=yes';
      document.head.appendChild(meta);
    }

    /* --- 載入 Unity loader --- */
    const loader = document.createElement('script');
    loader.src = buildUrl + '/WebGame.loader.js';
    loader.onload = () => {
      createUnityInstance(canvas, config, ()=>{/* no progress bar */})
        .then(instance=>{
          unityInstance = instance;
          document.querySelector('#unity-fullscreen-button').onclick =
            () => instance.SetFullscreen(1);
          // 初始一次 Canvas 尺寸
          resizeCanvas();
        })
        .catch(alert);
    };
    document.body.appendChild(loader);

    /* --- 節流 resize：150 ms 內只調整一次 --- */
    let resizeTimer = null;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(resizeCanvas, 150);
    });

    function resizeCanvas(){
      if(!unityInstance) return;
      const w = window.innerWidth,
            h = window.innerHeight;
      canvas.style.width  = w + 'px';
      canvas.style.height = h + 'px';
      unityInstance.SetCanvasSize(w, h, false); // 第三參數=false 表示 non-soft resize
    }

    /* --- 防止 iOS 彈性滑動造成黑屏 --- */
    document.documentElement.style.overscrollBehavior = 'none';
    document.documentElement.style.touchAction = 'none';
  </script>
</body>
</html>
