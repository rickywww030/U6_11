<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <title>Unity Web Player | RE_Web</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">

  <style>
    /*─── 全螢幕 CSS：DOM 永遠鋪滿 ───*/
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      background: #000;
    }
    #unity-container {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }
    /* 畫布 DOM 大小全螢幕，形變時跟著拉伸 */
    #unity-canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: #231F20;
    }
    /* 隱藏原本 loading bar */
    #unity-loading-bar,
    #unity-logo,
    #unity-progress-bar-empty,
    #unity-progress-bar-full {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="unity-container">
    <canvas id="unity-canvas" tabindex="-1"></canvas>
  </div>

  <script>
    const canvas = document.getElementById('unity-canvas');
    let unityInstance = null;

    // 一開始和 resize 結束後，設定一次內部解析度
    function updateInternalResolution() {
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    updateInternalResolution();  // 初始
    let resizeTimer = null;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      // 200ms 之後再更新解析度，拖曳過程中只靠 CSS 變形
      resizeTimer = setTimeout(updateInternalResolution, 200);
    });

    // Unity 建置參數
    const buildUrl = 'Build';
    const config = {
      dataUrl:            buildUrl + '/WebGame.data.unityweb',
      frameworkUrl:       buildUrl + '/WebGame.framework.js.unityweb',
      codeUrl:            buildUrl + '/WebGame.wasm.unityweb',
      streamingAssetsUrl: 'StreamingAssets',
      companyName:        'ArtRice',
      productName:        'RE_Web',
      productVersion:     '0.1',
      devicePixelRatio:   1,           // 降低高DPI負擔
      matchWebGLToCanvasSize: false,   // 關閉自動同步
      showBanner: (msg, type) => {     // 可選：顯示錯誤/警告
        const div = document.createElement('div');
        div.textContent = msg;
        div.style = `position:absolute;top:10px;left:10px;
                     background:${type==='error'?'#f88':'#ff8'};
                     padding:8px;`;
        document.body.appendChild(div);
        if (type!=='error') setTimeout(()=>div.remove(), 3000);
      },
    };

    // 手機 viewport
    if (/iPhone|iPad|Android/i.test(navigator.userAgent)) {
      const meta = document.createElement('meta');
      meta.name    = 'viewport';
      meta.content = 'width=device-width,height=device-height,initial-scale=1.0,'+
                     'user-scalable=no,shrink-to-fit=yes';
      document.head.appendChild(meta);
    }

    // 載入 Unity loader
    const loader = document.createElement('script');
    loader.src = buildUrl + '/WebGame.loader.js';
    loader.onload = () => {
      createUnityInstance(canvas, config, () => {/* 不顯示進度 */})
        .then(instance => {
          unityInstance = instance;
        })
        .catch(err => alert(err));
    };
    document.body.appendChild(loader);
  </script>
</body>
</html>
