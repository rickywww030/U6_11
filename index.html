<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Unity Smooth Resize</title>
  <style>
    html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#000;}
    #unity-container{
      position:fixed;top:0;left:0;
      width:100%;height:100%;
      transform-origin:top left;
      will-change:transform;
      background:#231F20;
      /* 拖曳時也想要平滑插值？可以打開： */
       transition: transform 0.15s ease-out;
    }
    #unity-canvas{display:block;background:#231F20;}
    /* 隱藏一切 loading bar */
    #unity-loading-bar,#unity-logo,
    #unity-progress-bar-empty,#unity-progress-bar-full{
      display:none!important;
    }
  </style>
</head>
<body>
  <div id="unity-container">
    <canvas id="unity-canvas" tabindex="-1"></canvas>
  </div>
  <script>
    const canvas    = document.getElementById('unity-canvas');
    const container = document.getElementById('unity-container');
    let unityInstance;

    // —— 1. 初始化 & CSS scale —— 
    // 先把 canvas 真實解析度設為視窗大小，CSS width/height 也做同樣
    function setCanvasRes(w,h){
      canvas.width  = w;
      canvas.height = h;
      canvas.style.width  = w + 'px';
      canvas.style.height = h + 'px';
    }
    function applyCSSscale(){
      const sx = window.innerWidth  / canvas.width;
      const sy = window.innerHeight / canvas.height;
      container.style.transform = `scale(${sx},${sy})`;
    }

    // 第一次
    setCanvasRes(window.innerWidth, window.innerHeight);
    applyCSSscale();

    // —— 2. 拖拉中：純 CSS scale GPU 插值 —— 
    window.addEventListener('resize', applyCSSscale);

    // —— 3. 拖拉後：分段解析度更新 —— 
    let finalResize;
    window.addEventListener('resize', ()=>{
      clearTimeout(finalResize);
      // 0.2s 後認定「拖完了」，再更新一次真實解析度
      finalResize = setTimeout(()=>{
        setCanvasRes(window.innerWidth, window.innerHeight);
        applyCSSscale();
      }, 200);
    });

    // —— 4. 載入 Unity —— 
    const buildUrl = 'Build';
    const config = {
      dataUrl:      buildUrl+'/WebGame.data.unityweb',
      frameworkUrl: buildUrl+'/WebGame.framework.js.unityweb',
      codeUrl:      buildUrl+'/WebGame.wasm.unityweb',
      streamingAssetsUrl:'StreamingAssets',
      matchWebGLToCanvasSize:false,     // 關閉新版自動 resize
      devicePixelRatio:1,               // 減輕高 DPI
      showBanner:(m,t)=>console.log(t,m),
    };
    // mobile viewport
    if(/iPhone|Android/i.test(navigator.userAgent)){
      const m=document.createElement('meta');
      m.name='viewport';
      m.content='width=device-width,height=device-height,initial-scale=1.0,user-scalable=no';
      document.head.appendChild(m);
    }
    const loader = document.createElement('script');
    loader.src = buildUrl + '/WebGame.loader.js';
    loader.onload = () => {
      createUnityInstance(canvas, config, ()=>{})
        .then(i=>unityInstance=i)
        .catch(alert);
    };
    document.body.appendChild(loader);
  </script>
</body>
</html>
