<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <title>Unity Web Player | RE_Web</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">

  <style>
    /* 1. 全螢幕容器 & 畫布 CSS 縮放 */
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      background: #000;
    }
    #unity-container {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }
    /* Canvas 的 DOM 大小由 CSS 控制，實際內部解析度由 width/height 屬性決定一次 */
    #unity-canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: #231F20;
    }

    /* 隱藏原本的 loading bar */
    #unity-loading-bar,
    #unity-logo,
    #unity-progress-bar-empty,
    #unity-progress-bar-full {
      display: none !important;
    }

    /* 以下 footer / warning 如有需要可自行保留 */
    #unity-footer { position: relative; }
    .unity-mobile #unity-footer { display: none; }
    #unity-logo-title-footer { float:left; width:102px; height:38px;
      background:url('unity-logo-title-footer.png') no-repeat center; }
    #unity-build-title { float:right; margin-right:10px; line-height:38px;
      font-family:arial; font-size:18px; }
    #unity-fullscreen-button { cursor:pointer; float:right; width:38px; height:38px;
      background:url('fullscreen-button.png') no-repeat center; }
    #unity-warning { position:absolute; left:50%; top:5%; transform:translateX(-50%);
      background:#fff; padding:10px; display:none; }
  </style>
</head>
<body>
  <div id="unity-container">
    <!-- 先不給 width/height，後續 JS 設定 -->
    <canvas id="unity-canvas" tabindex="-1"></canvas>
    <div id="unity-warning"></div>
    <div id="unity-footer">
      <div id="unity-logo-title-footer"></div>
      <div id="unity-fullscreen-button"></div>
      <div id="unity-build-title">RE_Web</div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('unity-canvas');
    let unityInstance = null;

    // 2. 在載入前，先把 <canvas> 的 width/height 設為當前視窗大小
    function initCanvasSize(){
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    initCanvasSize();

    // 3. Unity 參數
    const buildUrl = 'Build';
    const config = {
      dataUrl:            buildUrl + '/WebGame.data.unityweb',
      frameworkUrl:       buildUrl + '/WebGame.framework.js.unityweb',
      codeUrl:            buildUrl + '/WebGame.wasm.unityweb',
      streamingAssetsUrl: 'StreamingAssets',
      companyName:        'ArtRice',
      productName:        'RE_Web',
      productVersion:     '0.1',
      devicePixelRatio:   1,           // 降低高 DPI 負擔
      matchWebGLToCanvasSize: false,   // 完全關閉內建同步
      showBanner: function(msg, type){
        const warning = document.getElementById('unity-warning');
        const div = document.createElement('div');
        div.textContent = msg;
        div.style = background:${type==='error'?'red':'yellow'};padding:10px;;
        warning.appendChild(div);
        if(type!=='error') setTimeout(()=>warning.removeChild(div),5000);
      },
    };

    // 4. Mobile viewport
    if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){
      const meta = document.createElement('meta');
      meta.name    = 'viewport';
      meta.content = 'width=device-width,height=device-height,initial-scale=1.0,user-scalable=no,shrink-to-fit=yes';
      document.head.appendChild(meta);
    }

    // 5. 載入 Unity loader
    const loader = document.createElement('script');
    loader.src = buildUrl + '/WebGame.loader.js';
    loader.onload = () => {
      createUnityInstance(canvas, config, () => {/* no progress */})
        .then(instance => {
          unityInstance = instance;
          document.getElementById('unity-fullscreen-button')
            .onclick = () => instance.SetFullscreen(1);
        })
        .catch(alert);
    };
    document.body.appendChild(loader);

    // 6. 防止 iOS 彈性滑動導致 Context 暫停
    document.documentElement.style.overscrollBehavior = 'none';
    document.documentElement.style.touchAction       = 'none';
  </script>
</body>
</html>
