<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <title>Unity Web Player | RE_Web</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">

  <style>
    /*─── 全螢幕 CSS：DOM 永遠鋪滿 ───*/
    html, body {
      margin:0; padding:0;
      width:100%; height:100%;
      overflow:hidden;
      background:#000;
    }
    #unity-container {
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      transform:none;
      transform-origin:center center;
    }
    #unity-canvas {
      display:block;
      width:100%; height:100%;
      background:#231F20;
    }

    /*─── 只有當 #unity-container 有 portrait-rotate 時才轉 ───*/
    #unity-container.portrait-rotate {
      width:100vh;    /* 互換寬高 */
      height:100vw;
      top:50%; left:50%;
      transform:
        rotate(-90deg)
        translate(-50%,-50%);
    }

    /*─── Loading 條 與 Logo 樣式 ───*/
    #unity-loading-bar {
      position:absolute;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      text-align:center;
      pointer-events:none;
      user-select:none;
      z-index:10;
    }
    #unity-logo {
      width:154px; height:154px;
      background:url('TemplateData/unity-logo-dark.png') no-repeat center;
      margin:0 auto;
    }
    #unity-progress-bar-empty {
      width:300px; height:20px;
      background:#444;
      margin:10px auto 0;
      border-radius:10px;
      overflow:hidden;
    }
    #unity-progress-bar-full {
      width:0%; height:100%;
      background:#29a;
      transition:width 0.1s;
    }

    /*─── footer / warning（如需可留） ───*/
    #unity-footer { position:relative; }
    .unity-mobile #unity-footer { display:none; }
    #unity-logo-title-footer {
      float:left; width:102px; height:38px;
      background:url('TemplateData/unity-logo-title-footer.png') no-repeat center;
    }
    #unity-build-title {
      float:right; margin-right:10px;
      line-height:38px; font-family:arial; font-size:18px;
    }
    #unity-fullscreen-button {
      cursor:pointer; float:right;
      width:38px; height:38px;
      background:url('TemplateData/fullscreen-button.png') no-repeat center;
    }
    #unity-warning {
      position:absolute; left:50%; top:5%;
      transform:translateX(-50%);
      background:#fff; padding:10px; display:none;
    }
  </style>
</head>

<body>
  <div id="unity-container">
    <!-- Loading 條 -->
    <div id="unity-loading-bar">
      <div id="unity-logo"></div>
      <div id="unity-progress-bar-empty">
        <div id="unity-progress-bar-full"></div>
      </div>
    </div>

    <!-- Unity Canvas -->
    <canvas id="unity-canvas" tabindex="-1"></canvas>

    <!-- 其他元件 -->
    <div id="unity-warning"></div>
    <div id="unity-footer">
      <div id="unity-logo-title-footer"></div>
      <div id="unity-fullscreen-button"></div>
      <div id="unity-build-title">RE_Web</div>
    </div>
  </div>

  <script>
    const canvas   = document.getElementById('unity-canvas');
    const container= document.getElementById('unity-container');
    let unityInstance = null;

    // 檢查是否為行動裝置（簡單版）
    const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);

    // 初始化 canvas 大小
    function initCanvasSize(){
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    initCanvasSize();

    // 根據設備 & 方向決定要不要轉
    function updateRotation(){
      if(!isMobile) {
        container.classList.remove('portrait-rotate');
        return;
      }
      // 若行動裝置且豎屏 (height>width) 就加 class
      if(window.innerHeight > window.innerWidth){
        container.classList.add('portrait-rotate');
      } else {
        container.classList.remove('portrait-rotate');
      }
    }
    updateRotation();

    // resize 後節流呼叫
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      initCanvasSize();
      resizeTimer = setTimeout(updateRotation, 200);
    });

    // Unity config
    const buildUrl = 'Build';
    const config = {
      dataUrl:              buildUrl+'/WebGame.data.unityweb',
      frameworkUrl:         buildUrl+'/WebGame.framework.js.unityweb',
      codeUrl:              buildUrl+'/WebGame.wasm.unityweb',
      streamingAssetsUrl:   'StreamingAssets',
      companyName:          'ArtRice',
      productName:          'RE_Web',
      productVersion:       '0.1',
      devicePixelRatio:     1,
      matchWebGLToCanvasSize: false,
      showBanner: (msg,type) => {
        const w = document.getElementById('unity-warning');
        const d = document.createElement('div');
        d.textContent = msg;
        d.style = `background:${type==='error'?'red':'yellow'};padding:8px;`;
        w.appendChild(d);
        if(type!=='error') setTimeout(()=>w.removeChild(d),3000);
      }
    };

    // mobile viewport
    if(isMobile){
      const m = document.createElement('meta');
      m.name='viewport';
      m.content='width=device-width,height=device-height,initial-scale=1.0,user-scalable=no,shrink-to-fit=yes';
      document.head.appendChild(m);
    }

    // load Unity
    const loader = document.createElement('script');
    loader.src = buildUrl+'/WebGame.loader.js';
    loader.onload = () => {
      createUnityInstance(canvas, config, (p) => {
        document.getElementById('unity-progress-bar-full').style.width = (p*100)+'%';
      }).then(inst => {
        unityInstance = inst;
        document.getElementById('unity-loading-bar').style.display = 'none';
        document.getElementById('unity-fullscreen-button')
                .onclick = ()=>inst.SetFullscreen(1);
      }).catch(alert);
    };
    document.body.appendChild(loader);

    // iOS bounce prevent
    document.documentElement.style.overscrollBehavior = 'none';
    document.documentElement.style.touchAction       = 'none';
  </script>
</body>
</html>
